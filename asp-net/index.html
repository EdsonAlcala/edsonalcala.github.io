
<head>
	<meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">

	<title>Importar desde archivo Excel</title>
	<meta name="description" content="">
    <link rel="shortcut icon" href="../favicon.ico">

	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="../assets/css/screen.css">

	<link rel="canonical" href="http://edsonalcala.net/asp-net/">
    
    <meta property="og:site_name" content="Edson Alcala">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Importar desde archivo Excel">
    <meta property="og:description" content="Uno de los requerimientos comunes en el desarrollo de software es la importanción de información. En este caso me pidieron un componente que permitiera la importación desde un archivo excel, el cual contenia información de facturación de clientes. Los archivos...">
    <meta property="og:url" content="http://edsonalcala.net/asp-net/">
    <meta property="article:published_time" content="2015-07-03T08:25:59.147Z">
    <meta property="article:modified_time" content="2015-07-04T17:24:59.528Z">
    <meta property="article:tag" content="articles">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Importar desde archivo Excel">
    <meta name="twitter:description" content="Uno de los requerimientos comunes en el desarrollo de software es la importanción de información. En este caso me pidieron un componente que permitiera la importación desde un archivo excel, el cual contenia información de facturación de clientes. Los archivos...">
    <meta name="twitter:url" content="http://edsonalcala.net/asp-net/">
    
    <script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "Article",
    "publisher": "Edson Alcala",
    "author": {
        "@type": "Person",
        "name": "edson alcala",
        "image": "//www.gravatar.com/avatar/44a1efe902fd79018543ffb1e88fa70a?s=250&d=mm&r=x",
        "url": "http://edsonalcala.net/author/edson",
        "sameAs": null,
        "description": null
    },
    "headline": "Importar desde archivo Excel",
    "url": "http://edsonalcala.net/asp-net/",
    "datePublished": "2015-07-03T08:25:59.147Z",
    "dateModified": "2015-07-04T17:24:59.528Z",
    "keywords": "articles",
    "description": "Uno de los requerimientos comunes en el desarrollo de software es la importanción de información. En este caso me pidieron un componente que permitiera la importación desde un archivo excel, el cual contenia información de facturación de clientes. Los archivos..."
}
    </script>

    <meta name="generator" content="Ghost 0.6">
    <link rel="alternate" type="application/rss+xml" title="Edson Alcala" href="http://edsonalcala.net/rss/">

</head>

<body class="post-template tag-articles">
	<div class="container">
		<div class="row">
				<nav class="col-md-8 col-xs-12 col-md-offset-3 navbar navbar-default">
    <div class="navbar-header">
        <button class="navbar-toggle collapsed" data-target="#navbar-edsonsite" data-toggle="collapse" type="button">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
    </div>
    <div class="collapse navbar-collapse" id="navbar-edsonsite">
        <ul class="nav navbar-nav navbar-right">
            <li>
                <a href="../home/">Home</a>
            </li>
            <li>
                <a href="http://127.0.0.1:2368/resume">Resume</a>
            </li>
            <li>
                <a href="../demos/">Demos</a>
            </li>
            <li>
                <a href="../portfolio/">Portfolio</a>
            </li>
            <li>
                <a href="http://127.0.0.1:2368/reviews">Reviews</a>
            </li>           
            <li class="active">
                <a href="../">Blog</a>
            </li>
             <li>
                <a href="../about/">About me</a>
            </li>
        </ul>
    </div>
</nav>

		</div>
        <div class="row">					
               <!-- Everything inside the #post tags pulls data from the static page -->

<div class="col-md-2 col-md-offset-1">
    <h4>Series</h4>
    <ul class="list">
        
    </ul>
    <ul class="list">
        <li>
            <a href="http://127.0.0.1:2368/asp-net/tag/powershell">Powershell</a>
        </li>
        <li>
            <a href="http://127.0.0.1:2368/asp-net/tag/ghost">Ghost</a>
        </li>
        <li>
            <a href="http://127.0.0.1:2368/asp-net/tag/fsharp">F#</a>
        </li>
        <li>
            <a href="http://127.0.0.1:2368/asp-net/tag/aspnet">ASP.NET</a>
        </li>
    </ul>
</div>

<div class="col-md-7 col-md-offset-1">
    <div class="l-wrapper-ct theme-margin">
        <main class="l-main-ct" role="main">

            <article class="article-ct theme-margin" role="article">
                <header class="post-header-ct">

                    <h1 class="post-title-ct">
                      Importar desde archivo Excel
                    </h1>
                </header>

                <div class="post-content-ct">
                    <p>Uno de los requerimientos comunes en el desarrollo de software es la importanción de información. En este caso me pidieron un componente que permitiera la importación desde un archivo excel, el cual contenia información de facturación de clientes.</p>

<p>Los archivos Excel contenian los siguientes campos:</p>

<ul>
<li>StudentID</li>
<li>FirstName</li>
<li>LastName</li>
<li>Email</li>
<li>ItemName</li>
<li>ItemDescription</li>
<li>GLCode</li>
<li>Quantity</li>
<li>Rate</li>
<li>Total</li>
</ul>

<p><img src="http://127.0.0.1:2368/content/images/2015/04/excel_fields.png" alt=""></p>

<p>Al principio parecía una tarea muy simple, sin embargo tuve algunas complicaciones causadas por falta de experiencia en inserciones masivas a la base de datos.</p>

<p>Dentro de los requerimientos se necesitaba validar los datos del archivo Excel, entre las validaciones que necesitaba ejecutar están:</p>

<ul>
<li>Validar que el tipo de dato fuese el correcto</li>
<li>Validar que no hubiese nulos</li>
<li>Validar que total sea el producto de Rate * Quantity</li>
<li>Validar que StudentID realmente exista</li>
<li>Validar que GLCode exista</li>
</ul>

<p>Otro requerimiento era mostrar los datos importados y los datos que hayan sido insertados correctametne deberian mostrar el ID del registro recien insertado.</p>

<p>Es decir, se tienen 2 tablas: Invoice e InvoiceItem, por lo que por cada registro en el archivo excel debo insertar un registro en ambas tablas, sin embargo InvoiceItem necesita un InvoiceID, la siguiente imagen ilustra la relación entre estas tablas.</p>

<p>//TODO, agregar diagrama de tablas</p>

<p>Y el mockup de lo esperado es el siguiente:</p>

<p><img src="http://127.0.0.1:2368/content/images/2015/04/mockup-1.png" alt=""></p>

<p>Finalmente en caso de que un registro tenga un error, debo agregar una columna llamada excepción que muestre el mensaje "invalid data row".</p>

<h4 id="solucin">Solución</h4>

<p>La solución que he propuesto para este problema es la siguiente:</p>

<p>Leer el archivo excel</p>

<p>Ejecutar validaciones que no requieran base de datos, esto con el objetivo de solamente tomar en cuenta los registros que hasta el momento son válidos, ya que si al menos una de las validaciones que ejecute es incorrecta entonces no debo continuar, simplemente debo marcar ese registro como incorrecto y agregar a la columna Excepción el mensaje de "invalid data row", en el siguiente paso voy a separar los registros que son validos.</p>

<p>Separar registros válidos. En este paso debo ejecutar 2 validaciones del servidor, las cuales son: validar la existencia del StudentID y el GLCode. <br>
Por supuesto que si hago esto con un foreach o algún loop tomaría mucho tiempo, por lo que decido hacer algo.</p>

<p>Dado que tengo un conjunto de registros, si proyecto y hago una lista de StudentID's y una lista de GLCodes, entonces puedo enviar como parametro esa gran lista y hacer un simple join con la tabla correspondiente, entonces el resultado sería el total de StudentID's o GLCode's existentes.</p>

<p>//TODO, agregar imagen de operación con conjuntos</p>

<p>Es decir, una simple operación de conjuntos, ahora que tengo la lista de StudentID's y GLCodes válidos, debo hacer algo, voy a hacer un join con mi conjunto de datos y sacaré el total de registros válidos después de validar contra la base de datos.</p>

<p>Ya tengo los registros válidos, ahora debo insertar Invoices e InvoiceItems.</p>

<p>Para insertar datos másivos, haré algo.</p>

<pre><code>$(document).ready(function() {
    console.log('hello');
});</code></pre>
                </div>

                <div class="post-tags-ct">
                    Tags: <a href="../tag/articles/">articles</a>
                </div>

                <div class="sharepost-ct">
                    <h4>Share this post:</h4>
                    <ul>
                        <li><a class="share-ct" href="http://twitter.com/share?text=Importar%20desde%20archivo%20Excel&amp;url=http://edsonalcala.net/asp-net/">
      Twitter</a>
                        </li>
                    </ul>
                </div>
            </article>


        </main>
    </div>
</div>            
        </div>

		<div class="row site-wrapper-ct">
			<script src="http://127.0.0.1:2368/public/jquery.js?v=da3b9ba92e"></script>
		</div>
	</div>

	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>

    <!-- build:remove -->
    <script type="text/javascript" src="http://localhost:35729/livereload.js"></script>
    <!-- endbuild -->
</body>
